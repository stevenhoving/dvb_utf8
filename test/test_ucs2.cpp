#include "dvb_utf8.h"
#include "helpers.h"
#include <gtest/gtest.h>
#include <string>

using namespace dvb_utf8;

TEST(test_ucs2, test_ucs2be_decode)
{
    // dvb data stream with encoding identifier token for ucs2be (0x11).
    auto data = std::vector<uint8_t>{ 0x11,
        0x41, 0x00, 0x72, 0x00, 0x61, 0x00, 0x62, 0x00, 0x69, 0x00, 0x63, 0x00,
        0x09, 0x00, 0x09, 0x00, 0x09, 0xFE, 0x8D, 0xFE, 0xDF, 0xFE, 0xB4, 0xFE,
        0xFC, 0xFE, 0xE1, 0x00, 0x20, 0xFE, 0xCB, 0xFE, 0xE0, 0xFE, 0xF4, 0xFE,
        0xDC, 0xFE, 0xE2, 0x00, 0x0A, 0x00
    };

    auto decoded_text = dvb_utf8::decode(stream_buffer(data));

    auto data_utf8 = to_utf8_string({
        0x41, 0x72, 0x61, 0x62, 0x69, 0x63, 0x09, 0x09, 0x09, 0xEF, 0xBA, 0x8D,
        0xEF, 0xBB, 0x9F, 0xEF, 0xBA, 0xB4, 0xEF, 0xBB, 0xBC, 0xEF, 0xBB, 0xA1,
        0x20, 0xEF, 0xBB, 0x8B, 0xEF, 0xBB, 0xA0, 0xEF, 0xBB, 0xB4, 0xEF, 0xBB,
        0x9C, 0xEF, 0xBB, 0xA2, 0x0D, 0x0A
    });

    EXPECT_EQ(decoded_text, data_utf8);
}
